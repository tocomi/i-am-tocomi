---
import { Image } from 'astro:assets'
import portrait from '@/assets/portrait.jpg'

type Props = {
  size: number
}

const { size } = Astro.props
// NOTE: 画像サイズに合わせてボーダー幅を調整
const borderWidth = Math.max(1, Math.round(size * 0.025))
---

<div
  class="portrait-wrapper spinning"
  style={`--size: ${size}px; --border-width: ${borderWidth}px`}
  transition:name="portrait"
  role="button"
  tabindex="0"
>
  <Image
    src={portrait}
    alt="Portrait"
    width={size}
    height={size}
    class="rounded-full"
  />
</div>

<style>
  .portrait-wrapper {
    width: var(--size);
    height: var(--size);
    padding: var(--border-width);
    border-radius: 9999px;
    background: linear-gradient(90deg, purple, orange);
    display: inline-block;
    cursor: pointer;
    transition: transform 0.2s ease;
  }

  .portrait-wrapper.spinning {
    animation: spin 3s linear infinite;
  }

  .portrait-wrapper.spinning.paused {
    animation-play-state: paused;
  }

  @keyframes spin {
    from {
      transform: rotate(0deg);
    }
    to {
      transform: rotate(360deg);
    }
  }

  .portrait-wrapper :global(img) {
    display: block;
    object-fit: cover;
  }
</style>

<script>
  document.addEventListener('astro:page-load', () => {
    const portraits = document.querySelectorAll('.portrait-wrapper')

    portraits.forEach(portrait => {
      const handleClick = () => {
        portrait.classList.toggle('paused')
      }

      const handleKeyPress = (e: KeyboardEvent) => {
        if (e.key === 'Enter' || e.key === ' ') {
          e.preventDefault()
          portrait.classList.toggle('paused')
        }
      }

      portrait.addEventListener('click', handleClick)
      portrait.addEventListener('keypress', handleKeyPress as EventListener)
    })
  })
</script>
